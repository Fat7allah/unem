{% extends "templates/portal_base.html" %}

{% block portal_title %}
    {% if doc.name %}Edit Member: {{ doc.full_name }}{% else %}New Member{% endif %}
{% endblock %}

{% block portal_content %}
<div class="form-section">
    <form action="/api/method/unem.www.portal.member.save_member" method="POST">
        <input type="hidden" name="csrf_token" value="{{ frappe.session.csrf_token }}">
        {% if doc.name %}
        <input type="hidden" name="name" value="{{ doc.name }}">
        {% endif %}

        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="full_name">Full Name *</label>
                    <input type="text" class="form-control" id="full_name" name="full_name" 
                           value="{{ doc.full_name or '' }}" required>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="email">Email *</label>
                    <input type="email" class="form-control" id="email" name="email" 
                           value="{{ doc.email or '' }}" required>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="phone">Phone</label>
                    <input type="tel" class="form-control" id="phone" name="phone" 
                           value="{{ doc.phone or '' }}">
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="address">Address</label>
                    <textarea class="form-control" id="address" name="address" 
                              rows="3">{{ doc.address or '' }}</textarea>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <div class="checkbox">
                        <label>
                            <input type="checkbox" name="enabled" value="1" 
                                   {% if doc.enabled %}checked{% endif %}>
                            Active
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <hr>

        <div class="text-right">
            <a href="/portal/members" class="btn btn-default">Cancel</a>
            <button type="submit" class="btn btn-primary">Save</button>
        </div>
    </form>
</div>

{% if doc.name %}
<div class="form-section">
    <h3>Membership Cards</h3>
    <div class="list-view-table">
        <div class="list-row list-header">
            <div class="list-col" style="width: 20%">Card Number</div>
            <div class="list-col" style="width: 20%">Issue Date</div>
            <div class="list-col" style="width: 20%">Valid Until</div>
            <div class="list-col" style="width: 20%">Status</div>
            <div class="list-col" style="width: 20%">Actions</div>
        </div>
        
        {% for card in membership_cards %}
        <div class="list-row">
            <div class="list-col" style="width: 20%">{{ card.name }}</div>
            <div class="list-col" style="width: 20%">{{ frappe.format_date(card.issue_date) }}</div>
            <div class="list-col" style="width: 20%">{{ frappe.format_date(card.valid_until) }}</div>
            <div class="list-col" style="width: 20%">
                <span class="indicator {{ 'green' if card.status == 'Active' else 'red' }}"></span>
                {{ card.status }}
            </div>
            <div class="list-col" style="width: 20%">
                <a href="/portal/membership-cards/{{ card.name }}" class="btn btn-sm btn-default">
                    <i class="fa fa-pencil"></i>
                </a>
            </div>
        </div>
        {% endfor %}
    </div>

    {% if not membership_cards %}
    <div class="no-result text-muted">
        <p>No membership cards found</p>
    </div>
    {% endif %}
</div>
{% endif %}

{% endblock %}
